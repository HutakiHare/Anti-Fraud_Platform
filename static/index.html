<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¸ç¦ä¸å—é¨™ï¼šé˜²è©å…±å‰µè¡Œå‹•</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.2/marked.min.js"></script> 
    
    <style>
        :root {
            /* ç¾ä»£è‰²ç¥¨ (Modern Palette) - èª¿æ•´ç‚ºæ²‰ç©©/è­¦ç¤ºé¢¨æ ¼ */
            --primary: #475569;         /* Slate 600 - ä¸»è‰² (æ²‰ç©©æ·±è—ç°) */
            --primary-hover: #334155;   /* Slate 700 */
            --primary-light: #f1f5f9;   /* Slate 100 - è¼•å¾®èƒŒæ™¯è‰² */
            
            --success: #10b981;         /* Emerald 500 */
            --danger: #ef4444;          /* Red 500 - è­¦æˆ’è‰² */
            --warning: #f59e0b;         /* Amber 500 - è­¦ç¤ºè‰² */
            
            --bg-body: #f8fafc;         /* Slate 50 - èƒŒæ™¯ */
            --bg-card: #ffffff;
            
            --text-main: #0f172a;       /* Slate 900 */
            --text-secondary: #64748b;  /* Slate 500 */
            --text-placeholder: #94a3b8;
            
            --border-radius: 20px;
            --input-radius: 12px;
            
            /* æŸ”å’Œé™°å½± (Soft Shadows) */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-image: radial-gradient(circle at top right, #e2e8f0 0%, transparent 40%),
                              radial-gradient(circle at bottom left, #e2e8f0 0%, transparent 40%);
            background-attachment: fixed;
        }

        /* Glassmorphism Header */
        header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo-box {
            /* èª¿æ•´ç‚ºè­¦æˆ’è‰²ç³»ï¼Œä¾‹å¦‚ Amber */
            width: 42px;
            height: 42px;
            background: linear-gradient(135deg, var(--warning), #f9b640) !important;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(245, 158, 11, 0.4) !important;
        }

        h1 {
            font-size: 1.25rem;
            color: var(--text-main);
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        /* Main Layout */
        main {
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            padding: 2rem;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 2rem;
            align-items: start;
        }

        /* Modern Cards */
        .card {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255,255,255,0.6);
            height: 100%;
            min-height: 500px; 
            display: flex;
            flex-direction: column;
        }

        .card-header {
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--text-main);
        }
        
        .card-icon {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Modern Inputs */
        .input-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.6rem;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-main);
            margin-left: 4px;
        }
        
        /* èªéŸ³éŒ„è£½æŒ‡ç¤ºæ–‡å­— */
        h5 {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 400;
            margin-bottom: 0.5rem;
            margin-left: 4px;
        }


        textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid transparent;
            background-color: #f1f5f9;
            border-radius: var(--input-radius);
            font-size: 1rem;
            font-family: inherit;
            resize: none;
            transition: var(--transition);
            min-height: 120px; /* ç•¥å¾®é™ä½é«˜åº¦ä»¥å®¹ç´æ›´å¤šè¼¸å…¥å€å¡Š */
            color: var(--text-main);
        }

        textarea:focus {
            outline: none;
            background-color: #fff;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--primary-light);
        }

        textarea::placeholder {
            color: var(--text-placeholder);
        }

        /* File Upload */
        .file-upload-box {
            display: block;
            position: relative;
            background-color: #f1f5f9;
            border: 2px dashed #cbd5e1;
            border-radius: var(--input-radius);
            padding: 1rem;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }

        .file-upload-box:hover {
            border-color: var(--primary);
            background-color: #f8fafc;
        }

        input[type="file"] {
            width: 100%;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        input[type="file"]::file-selector-button {
            border: none;
            background: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            margin-right: 10px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        input[type="file"]::file-selector-button:hover {
            background: var(--primary-hover);
        }

        /* Buttons */
        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 0; /* è®“éŒ„éŸ³çµ„ä»¶æ›´ç·Šæ¹Š */
        }

        button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 0.85rem 1.5rem;
            border: none;
            border-radius: var(--input-radius);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        /* Primary Button (Send) */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-hover));
            color: white;
            width: 100%;
            margin-top: 1.5rem;
            box-shadow: 0 4px 12px rgba(71, 85, 105, 0.3);
            font-size: 1.05rem;
            padding: 1rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(71, 85, 105, 0.3);
        }
        
        /* éŒ„éŸ³ç›¸é—œæŒ‰éˆ•æ¨£å¼é‡æ–°å¼•å…¥ */
        .btn-record {
            background-color: white;
            border: 1px solid #e2e8f0;
            color: var(--text-main);
            box-shadow: var(--shadow-sm);
        }

        .btn-record:hover:not(:disabled) {
            border-color: var(--primary);
            color: var(--primary);
            background-color: #f8fafc;
        }

        .btn-record:disabled {
            background-color: #f1f5f9;
            color: #cbd5e1;
            cursor: not-allowed;
            border-color: transparent;
            box-shadow: none;
        }

        .btn-stop {
            background-color: #fef2f2;
            color: var(--danger);
            border: 1px solid #fee2e2;
        }

        .btn-stop:hover:not(:disabled) {
            background-color: #fee2e2;
            border-color: #fecaca;
            transform: translateY(-1px);
        }
        
        .btn-stop:disabled {
            background-color: #f1f5f9;
            color: #cbd5e1;
            cursor: not-allowed;
            border-color: transparent;
            background-image: none;
        }
        
        /* Recording Status */
        .recording-wrapper {
            height: 24px;
            margin-top: 0.5rem; 
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .recording-status {
            display: none;
            align-items: center;
            gap: 8px;
            background-color: #fef2f2;
            color: var(--danger);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            animation: fadeIn 0.3s ease;
        }
        
        .recording-dot {
            width: 8px;
            height: 8px;
            background-color: var(--danger);
            border-radius: 50%;
            box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }


        /* çµæœå€ - é¡¯ç¤º Markdown */
        .result-container {
            flex: 1;
            background-color: #f8fafc;
            border-radius: 16px;
            padding: 0;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .result-scroll-area {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            line-height: 1.8;
        }

        /* Markdown æ¨£å¼è¦†å¯« */
        .result-content {
            padding-bottom: 2rem;
        }
        .result-content h2, .result-content h3 {
            color: var(--primary-hover);
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.3rem;
            border-bottom: 2px solid var(--primary-light);
            font-weight: 700;
        }
        .result-content p {
            margin-bottom: 1rem;
            color: var(--text-main);
        }
        .result-content ul, .result-content ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        .result-content li {
            margin-bottom: 0.5rem;
        }
        .result-content blockquote {
            background-color: #fef3c7; /* Amber 100 */
            border-left: 4px solid var(--warning);
            padding: 1rem;
            border-radius: 8px;
            color: var(--text-main);
            font-style: italic;
            margin: 1rem 0;
        }
        .result-content strong {
            color: var(--danger); /* å¼·èª¿è­¦ç¤º */
        }
        .result-content code {
            background-color: var(--primary-light);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Inter', monospace;
            font-size: 0.95em;
        }

        /* é ç•™ç‹€æ…‹èˆ‡ Loading æ¨£å¼ (ä¿æŒä¸è®Š) */
        .result-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-placeholder);
            text-align: center;
            padding: 2rem;
        }

        .result-placeholder .icon-wrapper {
            width: 80px;
            height: 80px;
            background-color: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .result-placeholder i {
            font-size: 2.5rem;
            color: #cbd5e1;
        }
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--primary);
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--primary-light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Responsive */
        @media (max-width: 1024px) {
            main {
                grid-template-columns: 1fr;
                max-width: 800px;
            }
            .card {
                min-height: auto;
            }
            .result-container {
                min-height: 400px;
            }
        }
        @media (max-width: 640px) {
            main {
                padding: 1rem;
                gap: 1.5rem;
            }
            header {
                padding: 1rem;
            }
            .card {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <div class="logo-box">
                <i class="fa-solid fa-shield-halved"></i>
            </div>
            <h1>å¹¸ç¦ä¸å—é¨™ï¼šé˜²è©å…±å‰µè¡Œå‹•</h1>
        </div>
    </header>

    <main>
        <section class="card card-input">
            <div class="card-header">
                <i class="fa-solid fa-file-pen card-icon"></i>
                <span class="card-title">è¼¸å…¥èˆ‡æŸ¥æ ¸å…§å®¹</span>
            </div>

            <div class="input-group">
                <label for="textInput">1. æ–‡å­—/è¨Šæ¯å…§å®¹</label>
                <textarea id="textInput" placeholder="è«‹åœ¨æ­¤è¼¸å…¥å¯ç–‘çš„ç°¡è¨Šã€Line è¨Šæ¯ã€é›»å­éƒµä»¶æˆ–å…¶ä»–æ–‡å­—å…§å®¹..."></textarea>
            </div>

            <div class="input-group">
                <label>2. ä¸Šå‚³éŸ³æª”</label>
                <label class="file-upload-box">
                    <input type="file" id="audioUpload" accept="audio/*">
                </label>
            </div>

            <div class="input-group" style="margin-bottom: 0;">
                <label>3. èªéŸ³å³æ™‚éŒ„è£½</label>
                <h5>(æ“ä½œé †åº: â‘  æŒ‰é–‹å§‹éŒ„éŸ³ â‘¡ æŒ‰åœæ­¢)</h5>
                <div class="btn-group">
                    <button onclick="startRecording()" class="btn-record" id="btnRec">
                        <i class="fa-solid fa-microphone"></i> é–‹å§‹éŒ„éŸ³
                    </button>
                    <button onclick="stopRecording()" class="btn-stop" id="btnStop" disabled>
                        <i class="fa-solid fa-square"></i> åœæ­¢
                    </button>
                </div>
            </div>
            
            <div class="recording-wrapper">
                <div class="recording-status" id="recordingStatus">
                    <div class="recording-dot"></div>
                    <span>æ­£åœ¨éŒ„éŸ³...</span>
                </div>
            </div>

            <div class="input-group">
                <label>4. ä¸Šå‚³åœ–ç‰‡/è¢å¹•æˆªåœ–</label>
                <label class="file-upload-box">
                    <input type="file" id="imageUpload" accept="image/*">
                </label>
            </div>
            
            <button onclick="submit()" class="btn-primary">
                <i class="fa-solid fa-magnifying-glass"></i> ç«‹å³æŸ¥æ ¸
            </button>
            <p style="font-size:0.85rem; color:var(--text-secondary); text-align:center; margin-top:1rem;">*è«‹è‡³å°‘è¼¸å…¥ä¸€é …å…§å®¹é€²è¡ŒæŸ¥æ ¸ã€‚</p>
        </section>

        <section class="card">
            <div class="card-header">
                <i class="fa-solid fa-clipboard-check card-icon"></i>
                <span class="card-title">åˆ†æèˆ‡æŸ¥æ ¸å ±å‘Š</span>
            </div>

            <div class="result-container">
                <div class="result-scroll-area" id="result">
                    <div class="result-placeholder">
                        <div class="icon-wrapper">
                            <i class="fa-solid fa-check-shield"></i>
                        </div>
                        <h4 style="color:var(--text-main); margin-bottom:8px; font-weight:600;">ç­‰å¾…æŸ¥æ ¸</h4>
                        <p>è«‹åœ¨å·¦å´è¼¸å…¥å…§å®¹ä¸¦é»æ“Šã€Œç«‹å³æŸ¥æ ¸ã€<br>ç³»çµ±å°‡ç‚ºæ‚¨åˆ†ææ½›åœ¨çš„è©é¨™é¢¨éšª</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        let recorder, audioBlob;
        let isRecording = false;

        // æ¨¡æ“¬å¾Œç«¯å›å‚³çš„ Markdown å…§å®¹
        // å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œå¾Œç«¯æœƒæ ¹æ“šè¼¸å…¥ (text, transcribed_audio, image_ocr) ç”¢ç”Ÿå°æ‡‰çš„å ±å‘Š
        const MOCK_MARKDOWN = (inputType, recognizedText = "") => {
            let title, content;
            
            if (inputType === 'text') {
                title = "æ–‡å­—è¨Šæ¯è©é¨™é¢¨éšªè©•ä¼°";
                content = recognizedText ? recognizedText : "æ‚¨è¼¸å…¥çš„æ–‡å­—å…§å®¹æ­£åœ¨åˆ†æä¸­...";
            } else if (inputType === 'audio') {
                title = "èªéŸ³è©é¨™é¢¨éšªè©•ä¼° (èªéŸ³å…§å®¹å·²æˆåŠŸè¾¨è­˜)";
                content = recognizedText ? `è¾¨è­˜çµæœï¼š\`${recognizedText}\`` : "èªéŸ³è¾¨è­˜æˆåŠŸï¼Œä½†èªæ„åˆ†æå°šæœªå®Œæˆã€‚";
            } else if (inputType === 'image') {
                title = "åœ–ç‰‡å…§å®¹è©é¨™é¢¨éšªè©•ä¼°";
                content = "åœ–ç‰‡/æˆªåœ–å·²ä¸Šå‚³ï¼Œæ­£åœ¨é€²è¡Œ OCR èˆ‡é¢¨éšªåˆ†æ...";
            } else {
                title = "ç¶œåˆè©é¨™é¢¨éšªå ±å‘Š";
                content = "å¤šç¨®è¼¸å…¥å…§å®¹æ­£åœ¨ç¶œåˆåˆ†æä¸­...";
            }

            return `
# ğŸš¨ ${title} ğŸš¨

**ç‹€æ…‹ï¼š** ç™¼ç¾ **åš´é‡** è©é¨™é¢¨éšª

---

## ğŸ” å…§å®¹åˆ†ææ‘˜è¦
> ${content}

é€™å‰‡å…§å®¹åˆ©ç”¨äº†ã€Œ**æ€¥è¿«æ€§**ã€å’Œã€Œ**é‡‘éŒ¢åˆ©ç›Š**ã€ä¾†èª˜é¨™ä½¿ç”¨è€…é»æ“Šé€£çµï¼Œæ˜¯å…¸å‹çš„é‡£é­šè©é¨™æ‰‹æ³•ã€‚

## ğŸ›¡ï¸ åˆ¤æ–·ä¾æ“š
* **é—œéµè©å¥:** è¨Šæ¯ä¸­åŒ…å«ã€Œ**æ¬ è²»å°‡æ–¼ä»Šæ—¥åœç”¨**ã€ã€ã€Œ**ç«‹å³ç™»å…¥**ã€ã€ã€Œ**å„ªæƒ **ã€ç­‰é«˜åº¦è­¦ç¤ºè©å½™ã€‚
* **æ‰‹æ³•æ¨¡å¼:** é€™æ˜¯å¸¸è¦‹çš„ **é›»ä¿¡/éŠ€è¡Œé‡£é­šè©é¨™**ï¼Œç›®æ¨™æ˜¯ç«Šå–æ‚¨çš„å¸³è™Ÿå¯†ç¢¼æˆ–ä¿¡ç”¨å¡è³‡è¨Šã€‚
* **å¤–éƒ¨é€£çµ:** é€£çµçš„ç¶²å€é€šå¸¸èˆ‡å®˜æ–¹ç¶²ç«™ä¸ç¬¦ï¼Œè«‹**åˆ‡å‹¿é»æ“Š**ï¼

## ğŸš€ æ‚¨çš„è¡Œå‹• (é˜²è©ä¸‰æ­¥é©Ÿ)
1.  **å‹¿é»æ“Š:** çµ•å°ä¸è¦é»æ“Šè¨Šæ¯ä¸­çš„é€£çµæˆ–ä¸‹è¼‰é™„ä»¶ã€‚
2.  **å‹¿å›è¦†:** ä¸å›å‚³ä»»ä½•å€‹äººè³‡è¨Šï¼Œä¸¦ç«‹å³å°é–è©²è™Ÿç¢¼ã€‚
3.  **é€šå ±:** å°‡è¨Šæ¯æˆªåœ–ä¸¦é€šå ±çµ¦ **165 åè©é¨™è«®è©¢å°ˆç·š** æˆ–æ‚¨ä¿¡ä»»çš„è³‡å®‰å–®ä½ã€‚
`;
        };

        // --- èªéŸ³éŒ„è£½é‚è¼¯ (å¾åŸå§‹ä»£ç¢¼ä¸­é‚„åŸ) ---
        async function startRecording() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert("âš ï¸ æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´éŒ„éŸ³åŠŸèƒ½ï¼Œæˆ–æœªå…è¨±æ¬Šé™ã€‚");
                return;
            }

            // æ¸…é™¤ä¹‹å‰çš„éŒ„éŸ³ Blob
            audioBlob = null; 

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                recorder = new MediaRecorder(stream);
                const chunks = [];
                recorder.ondataavailable = e => chunks.push(e.data);
                recorder.onstop = () => {
                    audioBlob = new Blob(chunks, { type: 'audio/webm' });
                    stream.getTracks().forEach(track => track.stop());
                };
                recorder.start();
                isRecording = true;
                
                // UI æ›´æ–°
                document.getElementById('recordingStatus').style.display = 'flex';
                document.getElementById('btnRec').disabled = true;
                document.getElementById('btnStop').disabled = false;
                
            } catch (err) {
                console.error("éŒ„éŸ³å¤±æ•—ï¼š", err);
                alert("âš ï¸ ç„¡æ³•å•Ÿå‹•éº¥å…‹é¢¨ï¼Œè«‹æª¢æŸ¥æ¬Šé™è¨­å®šã€‚");
            }
        }

        function stopRecording() {
            if (recorder && isRecording) {
                recorder.stop();
                isRecording = false;
                
                // UI æ›´æ–°
                document.getElementById('recordingStatus').style.display = 'none';
                document.getElementById('btnRec').disabled = false;
                document.getElementById('btnStop').disabled = true;
                alert("éŒ„éŸ³å·²åœæ­¢ä¸¦å„²å­˜ã€‚è«‹é»æ“Š 'ç«‹å³æŸ¥æ ¸' é€å‡ºã€‚"); 
            }
        }
        
        // æ–°å¢çš„ Markdown æ¸²æŸ“å‡½å¼
        function renderMarkdown(markdownText) {
            const resultDiv = document.getElementById("result");
            // ä½¿ç”¨ marked.js å°‡ Markdown è½‰æ›ç‚º HTML
            // ç”±æ–¼æ‚¨è¦é¡¯ç¤º Markdownï¼Œæˆ‘å€‘å‡è¨­æ‚¨å·²ç¶“åŒ…å«äº† marked.min.js
            const htmlContent = marked.parse(markdownText); 

            resultDiv.innerHTML = `
                <div class="result-content">
                    ${htmlContent}
                </div>
            `;
            // è®“çµæœå€æ²å‹•åˆ°é ‚éƒ¨
            resultDiv.scrollTo(0, 0);
        }

        // --- æäº¤é‚è¼¯ (æ•´åˆå››ç¨®è¼¸å…¥å’Œ API å‘¼å«) ---
      async function submit() {
            const text = document.getElementById("textInput").value.trim();
            const audioInput = document.getElementById("audioUpload");
            const imageInput = document.getElementById("imageUpload");
            const resultDiv = document.getElementById("result");

            // 1. æª¢æŸ¥æ˜¯å¦æœ‰ä»»ä½•æœ‰æ•ˆè¼¸å…¥
            const hasAudioFile = audioInput.files.length > 0;
            const hasRecordedAudio = !!audioBlob; // æª¢æŸ¥éŒ„éŸ³ Blob æ˜¯å¦å­˜åœ¨
            const hasImage = imageInput.files.length > 0;
            const hasText = text.length > 0;

            if (!hasText && !hasAudioFile && !hasRecordedAudio && !hasImage) {
                // é¡¯ç¤ºç¼ºå°‘å…§å®¹çš„æç¤º (ä½¿ç”¨æ‚¨åŸæœ‰çš„ placeholder æ¨£å¼)
                resultDiv.innerHTML = `
                    <div class="result-placeholder">
                        <div class="icon-wrapper" style="background-color:#fef2f2; color:var(--danger);">
                            <i class="fa-solid fa-triangle-exclamation" style="color:var(--danger);"></i>
                        </div>
                        <h4 style="color:var(--text-main); margin-bottom:8px;">ç¼ºå°‘å…§å®¹</h4>
                        <p>è«‹è‡³å°‘æä¾›ä¸€é …å…§å®¹é€²è¡ŒæŸ¥æ ¸ã€‚</p>
                    </div>
                `;
                return;
            }

            // é¡¯ç¤º Loading ç‹€æ…‹
            resultDiv.innerHTML = `
                <div class="loading-container">
                    <div class="spinner"></div>
                    <p style="font-weight:500; color:var(--text-secondary)">æ­£åœ¨èˆ‡ Agent ç³»çµ±æºé€šï¼Œè«‹ç¨å€™...</p>
                </div>
            `;

            // 2. å»ºç«‹ FormData å°è±¡
            const formData = new FormData();
            let isAudioMode = false;

            // A. è™•ç†æ–‡å­—è¼¸å…¥ (Text, æˆ–å·²çŸ¥çš„ STT çµæœ)
            if (hasText) {
                // ä»»ä½•æ–‡å­—éƒ½é€é 'text' æ¬„ä½å‚³é
                formData.append("text", text);
            }

            // B. è™•ç†éŸ³æª”ä¸Šå‚³ (Audio File)  
            //C. è™•ç†å³æ™‚éŒ„éŸ³ (Recorded Audio Blob)
           if (hasAudioFile || hasRecordedAudio){ 
               isAudioMode = true;
               if (hasAudioFile) {
                    // å°‡ä¸Šå‚³çš„éŸ³æª”ä½œç‚º 'media_file' å‚³éçµ¦å¾Œç«¯
                    formData.append("files", audioInput.files[0], audioInput.files[0].name);
                } 

                //
                else if (hasRecordedAudio) {
                    // å°‡éŒ„éŸ³ Blob åŒ…è£æˆ File å°è±¡ï¼Œä½œç‚º 'media_file' å‚³é
                    //formData.append("file", audioBlob, "recorded_audio.webm");
                    formData.append("files", new File([audioBlob], "recorded.webm"));
                }
               let transcribeResult;
               let fullText = "";

                // å…ˆé€²è¡ŒèªéŸ³è½‰æ–‡å­—
                try {
                    const response = await fetch("http://140.123.105.233:8080/transcribe/", {
                        method: "POST",
                        headers: { "accept": "application/json" },
                        body: formData
                    });
                    transcribeResult = await response.json();
                    fullText = transcribeResult.result[0].transcription;
                } catch (err) {
                    console.error("èªéŸ³è¾¨è­˜éŒ¯èª¤ï¼š", err);
                    resultDiv.innerHTML = `
                        <div class="result-placeholder" style="color:var(--danger);">
                            <i class="fa-solid fa-triangle-exclamation fa-2x"></i>
                            <p style="margin-top:10px;">èªéŸ³è¾¨è­˜å¤±æ•—ï¼š${err.message || "ç„¡æ³•é€£ç·š"}</p>
                        </div>
                    `;
                    return; // ä¸­æ–·å¾ŒçºŒåŸ·è¡Œ
                }
               formData.append("text", fullText);
          }

            // D. è™•ç†åœ–ç‰‡ä¸Šå‚³ (Image File)
            else if (hasImage) {
                // å°‡åœ–ç‰‡ä½œç‚º 'media_file' å‚³é
                formData.append("file", imageInput.files[0], imageInput.files[0].name);
            }

            // 3. å‘¼å« API
            // âš ï¸ è«‹æ›¿æ›ç‚ºæ‚¨çš„ Port 9001 æœå‹™å™¨åœ°å€
            const API_ENDPOINT = "http://140.123.105.233:9001/check_scam_report"; 

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: "POST",
                    // â— æ³¨æ„: ç•¶ä½¿ç”¨ FormData å‚³è¼¸æª”æ¡ˆæ™‚ï¼Œä¸è¦æ‰‹å‹•è¨­ç½® 'Content-Type' headerï¼Œ
                    // ç€è¦½å™¨æœƒè‡ªå‹•è¨­ç½®æ­£ç¢ºçš„ 'multipart/form-data' å’Œé‚Šç•Œã€‚
                    body: formData,
                });

                // æª¢æŸ¥ HTTP ç‹€æ…‹ç¢¼
                if (!response.ok) {
                    let errorDetail = `ä¼ºæœå™¨è¿”å›ç‹€æ…‹ç¢¼: ${response.status}`;
                    try {
                        const errorJson = await response.json();
                        errorDetail += `<br>éŒ¯èª¤è©³æƒ…: ${errorJson.detail || JSON.stringify(errorJson)}`;
                    } catch (e) {
                        // å¦‚æœå›å‚³çš„ä¸æ˜¯ JSONï¼Œå¯èƒ½æ˜¯ä¼ºæœå™¨éŒ¯èª¤é é¢
                        errorDetail += `<br>éŒ¯èª¤è¨Šæ¯: ç„¡æ³•è§£æä¼ºæœå™¨å›è¦†ã€‚`;
                    }

                    resultDiv.innerHTML = `
                        <div class="result-placeholder" style="color:var(--danger);">
                            <i class="fa-solid fa-server fa-2x"></i>
                            <p style="margin-top:10px;">å¾Œç«¯æœå‹™å™¨éŒ¯èª¤</p>
                            <p style="font-size:0.9rem; color:var(--text-secondary);">${errorDetail}</p>
                        </div>
                    `;
                    return;
                }

                const data = await response.json();

                // 4. æ¸²æŸ“ Markdown çµæœ
                if (data.report) {
                    // ä½¿ç”¨ marked.js å°‡ Markdown å ±å‘Šæ¸²æŸ“æˆ HTML
                    const htmlContent = marked.parse(data.report); 

                    // å°‡çµæœå…§å®¹å¡«å…¥ result-scroll-area
                    resultDiv.innerHTML = `<div class="result-content">${htmlContent}</div>`;
                    resultDiv.scrollTo(0, 0);

                } else {
                    resultDiv.innerHTML = `
                        <div class="result-placeholder">
                            <div class="icon-wrapper" style="background-color:#fef3c7; color:var(--warning);">
                                <i class="fa-solid fa-triangle-exclamation" style="color:var(--warning);"></i>
                            </div>
                            <h4 style="color:var(--text-main); margin-bottom:8px;">å ±å‘Šç”Ÿæˆå¤±æ•—</h4>
                            <p>Agent ç³»çµ±æœªè¿”å›æœ‰æ•ˆçš„æŸ¥æ ¸å ±å‘Šã€‚</p>
                        </div>
                    `;
                }

            } catch (error) {
                // è™•ç†ç¶²è·¯éŒ¯èª¤ (ä¾‹å¦‚ CORS éŒ¯èª¤ã€æœå‹™å™¨æœªå•Ÿå‹•)
                console.error("Fetch API Error:", error);
                resultDiv.innerHTML = `
                    <div class="result-placeholder" style="color:var(--danger);">
                        <i class="fa-solid fa-plug-circle-xmark fa-2x"></i>
                        <p style="margin-top:10px;">ç¶²è·¯é€£ç·šå¤±æ•—</p>
                        <p style="font-size:0.9rem; color:var(--text-secondary);">ç„¡æ³•é€£ç·šåˆ°å¾Œç«¯æœå‹™å™¨ (${API_ENDPOINT})ï¼Œè«‹æª¢æŸ¥æœå‹™æ˜¯å¦å·²å•Ÿå‹•ã€‚</p>
                    </div>
                `;
            } finally {
                // æ¸…ç†éŒ„éŸ³ç‹€æ…‹ï¼Œé¿å…é‡è¤‡æäº¤åŒä¸€å€‹éŒ„éŸ³
                audioBlob = null;
                // æ¸…ç†æª”æ¡ˆè¼¸å…¥æ¡†ï¼Œç¢ºä¿ä¸‹æ¬¡æäº¤çš„æ˜¯æ–°çš„å…§å®¹
                audioInput.value = '';
                imageInput.value = '';
            }
        }
        
        // é é¢è¼‰å…¥æ™‚æ¸…é™¤æª”æ¡ˆè¼¸å…¥
        document.getElementById('audioUpload').value = '';
        document.getElementById('imageUpload').value = '';
        document.getElementById('textInput').value = '';

    </script>
</body>
</html>